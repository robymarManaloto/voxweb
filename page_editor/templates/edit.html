<!DOCTYPE html>
<html lang="en">

<head>
  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoxWeb - Website Editor</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous"/>
    <link href="/static/grapes.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@sweetalert2/themes@5.0.15/minimal/minimal.css">
    <link href="/static/main.css" rel="stylesheet">
    <link href="/static/loader.css" rel="stylesheet">

    <style>
      .swal2-backdrop-show{
        background: linear-gradient(to right, #176B87, #04364A) !important;
        transition: 0.5s filter !important;
      }

      .topbar {
        background: linear-gradient(to right, #04364A, #176B87);
        color: #F5FCCD;
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center; /* Center vertically */
      }
      
      .left-content{
        align-items: center; /* Center vertically */
      }

      .topbar button {
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-right: 10px;
      }
  
      .topbar button:hover {
        transform: scale(1.1);
      }
      
    </style>

    <style>
      .gjs-one-bg {
      background-color: #176B87 !important;
      font-family: 'Montserrat';
    }
    
    .gjs-one-color {
      color: #64CCC5 !important;
      
    }
    
    .gjs-one-color-h:hover {
      color: #64CCC5 !important;
      
    }
    
    .gjs-two-bg {
      background-color: #64CCC5 !important;
      
    }
    
    .gjs-two-color {
      color: #ffffff !important;
      
    }
    
    .gjs-two-color-h:hover {
      color: #64CCC5 !important;
      
    }
    
    .gjs-three-bg {
      background-color: #64CCC5 !important;
      
    }
    
    .gjs-three-color {
      color: #64CCC5 !important;
      
    }
    
    .gjs-three-color-h:hover {
      color: #64CCC5 !important;
      
    }
    
    .gjs-four-bg {
      background-color: #176B87 !important;
      
    }
    
    .gjs-four-color {
      color: #64CCC5 !important;
      
    }
    
    .gjs-four-color-h:hover {
      color: #64CCC5 !important;
    }

    .gjs-cv-canvas__frames{
      background-color: #808080;
    }
  
    </style>

    <script src="https://cdn.lordicon.com/lordicon-1.1.0.js"></script>
    <script src="https://unpkg.com/siriwave/dist/siriwave.umd.min.js"></script>
        
    <!-- Load Bootstrap JS from UNPKG -->
    <script src="https://unpkg.com/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Load GrapeJS and its plugins from UNPKG -->
    <script src="https://unpkg.com/grapesjs"></script>
    <script src="https://unpkg.com/grapesjs-preset-webpage"></script>
    <script src="https://unpkg.com/grapesjs-blocks-basic"></script>
    <script src="https://unpkg.com/grapesjs-plugin-forms"></script>
    <script src="https://unpkg.com/grapesjs-plugin-export"></script>
    <script src="https://unpkg.com/grapesjs-style-bg"></script>
    
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script defer src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" integrity="sha384-rOA1PnstxnOBLzCLMcre8ybwbTmemjzdNlILg8O7z1lUkLXozs4DHonlDtnE7fpc" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  </head>
<body>
  <div id="loading" class="loading">
  <div class="loading-container">
    <div class="loading-text">
      <span><img src="/static/logo.png" height="100em" alt="Logo"></span>
    </div>
  </div>
  </div>

    {% csrf_token %}
    <div class="topbar">
      <div class="left-content">
        <!-- Logo goes here -->
        <button id="back-button" style="padding:0.3em;">
        <lord-icon
          src="https://cdn.lordicon.com/eavayqgw.json"
          trigger="hover"
          stroke="bold"
          colors="primary:#ffffff,secondary:#08a88a"
          style="width:30px;height:30px; margin-bottom:-10px;">
      </lord-icon>
        </button>
        <img src="/static/logo.png" height="40px" alt="Logo">
      </div>
      <div class="right-content">
        <button id="askvox"><lord-icon
          src="https://cdn.lordicon.com/rhprarly.json"
          trigger="loop"
          colors="primary:#ffffff,secondary:#ffffff"
          style="width:30px;height:30px; margin-bottom:-8px;">
      </lord-icon> Ask Vox, they say!</button>
        <button id="stop-btn" style="display: none;"><i class="fas fa-stop"></i> Stop</button>
        <button id="export-btn"><i class="fas fa-download"></i> Export to ZIP</button>
      </div>
    </div>
    <div class="app-wrap">
        
        <div class="pages-wrp">
          <div class="px-4 py-4" style="text-align: center;">
            <h2>Pages</h2>
            <!-- Your content goes here -->
        </div>
          <div class="pages">
            <div v-for="page in pages" :key="page.id" :class="{page: 1, selected: isSelected(page) }" @click="selectPage(page.id)">
              <i class="fas fa-code"></i>
              <span @click="editPageName(page)">[[ page.get('name') || page.id ]]</span> <span v-if="!isSelected(page)" @click="removePage(page.id)" class="page-close"><lord-icon
    src="https://cdn.lordicon.com/drxwpfop.json"
    trigger="hover"
    colors="primary:#ffffff,secondary:#64ccc5"
    style="width:20px;height:20px;margin-bottom:-7px;">
</lord-icon></span>

              </div>
                                
          </div>
            
          <div class="add-page" style="text-align: center;" @click="addPage">
            <lord-icon
            src="https://cdn.lordicon.com/wzwygmng.json"
            trigger="hover"
            colors="primary:#dafffb,secondary:#dafffb"
            style="width:2em;height:2em">
        </lord-icon>
        </div>
        </div>

        <div class="editor-wrap">
          <div id="gjs"></div>
        </div>

      </div>
    </div>

</body>
</html>

<script src="/static/editpage.js"></script>
<script src="/static/voicerecognition.js"></script>
<script>  
  // Main code
  let editor;
  const loader = document.getElementById('loading');
  $(document).ready(function () {
    const csrftoken = getCSRFToken();
    $.ajax({
      url: '{% url "get_html_files" %}',
      type: 'GET',
      headers: {
        "X-CSRFToken": csrftoken,
      },
      dataType: 'json',
      success: function (response) {
        const pages = response.html_files;
        editor = initializeEditor(pages);
        addExportButtonListener(editor);
        createVueApp(editor);
        addVoiceListener(editor);
      
        // Hide the loading element once data is loaded
        setTimeout(function () {
          loader.style.display = "none";
        }, 2000);
      },
      error: function (xhr, status, error) {
        loader.style.display = "none";
        // Display a SweetAlert for the error
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: 'Pages are not displaying correctly. Please go back to the previous page.',
        }).then(function () {
          window.history.back();
        });
      },
    });
  });
  
  
  
  document.getElementById('back-button').addEventListener('click', function() {
    Swal.fire({
      title: 'Are you sure?',
      text: 'Do you want to go back to the last page?',
      icon: 'question',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'Yes, go back!'
    }).then((result) => {
      if (result.isConfirmed) {
        // Add your logic to navigate back to the last page here
        window.history.back();
      }
    });
  });


document.addEventListener('DOMContentLoaded', () => {
    // Check if the microphone is available
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        // Microphone not detected, show SweetAlert
        loader.style.display = "none";
        Swal.fire({
            title: 'Microphone Not Detected',
            text: 'Please make sure your microphone is connected and try again.',
            icon: 'error',
            confirmButtonText: 'Go Back',
            allowOutsideClick: false
        }).then((result) => {
            if (result.isConfirmed) {
                // User clicked "Go Back", navigate back
                window.history.back();
            }
        });
    }
});

const askvox = document.getElementById('askvox');
askvox.addEventListener('click', function () {
  speak("If you wish to regenerate the page, just say my name!");
});

function speak(text) {
  const message = new SpeechSynthesisUtterance(text);
  const voices = window.speechSynthesis.getVoices();
  const maleVoice = voices.find(voice => voice.name.includes("Google UK English Male"));
  if (maleVoice) message.voice = maleVoice;
  window.speechSynthesis.speak(message);
}

window.speechSynthesis.onvoiceschanged = () => {
  speak("This is a male voice.");
};

</script>