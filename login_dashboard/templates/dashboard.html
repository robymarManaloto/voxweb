<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="csrf-token" content="{{ csrf_token }}">
  <title>VoxWeb - Project Dashboard</title>
  <link rel="icon" type="image/x-icon" href="/static/voice_recognition/favicon.png">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
  <link href="/static/loader.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-dark@5.0.15/dark.min.css" rel="stylesheet">
  <link href='https://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet'>
  <script src="https://cdn.lordicon.com/lordicon-1.1.0.js"></script>

  <style>
    /* Custom CSS for responsiveness */
    @media (max-width: 767.98px) {
      .navbar-nav {
        text-align: center;
        margin: 0 auto;
      }
    }


    .swal2-popup {
      background: linear-gradient(45deg, #176B87, #04364A);
    }

    body {
      font-family: 'Montserrat';
      background-color: #f8f9fa;
    }

    .navbar {
      background-color: #343a40;
    }

    .navbar-brand {
      color: #ffffff;
      font-weight: bold;
    }

    .navbar-dark .navbar-nav .nav-link {
      color: #ffffff;
    }

    .navbar-dark .navbar-nav .nav-link:hover {
      color: #ced4da;
    }

    .list-group-item {
      border: 1px solid #dee2e6;
      margin-bottom: 5px;
      border-radius: 5px;
    }

    .list-group-item:hover {
      background-color: #f8f9fa;
    }

    .list-group-item i {
      cursor: pointer;
      color: #dc3545;
    }

    .list-group-item i:hover {
      color: #bd2130;
    }

    h2 {
      color: #343a40;
    }

    .placeholder-text {
      color: #6c757d;
      text-align: center;
      margin-top: 10px;
    }
  </style>
  <style>
    body {
      background-color: #F1F2EB; /* Set a dark background color fitting the navbar gradient */
    }
    .navbar {
      background: linear-gradient(135deg, #04364A, #176B87);
    }

    .card {
      margin: 20px;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .card-header {
      background-color: #176B87;
      color: #fff;
      text-align: center;
      padding: 10px;
    }

    .card-body {
      padding: 20px;
    }

    .list-group-item {
      padding: 15px;
      border: none;
      border-bottom: 1px solid #ddd;
    }

    .list-group-item:last-child {
      border-bottom: none;
    }

    .thumbnail {
      width: 50px;
      height: 50px;
      object-fit: cover;
      border-radius: 5px;
      margin-right: 10px;
    }

    .btn-main{
      background-color: #176B87;
      color: #ddd;
    }
    
    .btn-main:hover{
      opacity: 80%;
      color: #ddd;
    }
  </style> 
  <style>
    .card-header {
      font-family: 'Montserrat';
      background: linear-gradient(315deg, #64CCC5 20%, #04364A 98%);
      animation: gradient 15s ease infinite;
      background-size: 400% 400%;
      background-attachment: fixed;
    }

      @keyframes gradient {
          0% {
              background-position: 0% 0%;
          }
          50% {
              background-position: 100% 100%;
          }
          100% {
              background-position: 0% 0%;
          }
      }

      .wave {
          background: rgb(255 255 255 / 25%);
          border-radius: 1000% 1000% 0 0;
          position: fixed;
          width: 200%;
          height: 12em;
          animation: wave 10s -3s linear infinite;
          transform: translate3d(0, 0, 0);
          opacity: 0.8;
          bottom: 0;
          left: 0;
          z-index: -1;
      }

      .wave:nth-of-type(2) {
          bottom: -1.25em;
          animation: wave 18s linear reverse infinite;
          opacity: 0.8;
      }

      .wave:nth-of-type(3) {
          bottom: -2.5em;
          animation: wave 20s -1s reverse infinite;
          opacity: 0.9;
      }

      @keyframes wave {
          2% {
              transform: translateX(1);
          }

          25% {
              transform: translateX(-25%);
          }

          50% {
              transform: translateX(-50%);
          }

          75% {
              transform: translateX(-25%);
          }

          100% {
              transform: translateX(1);
          }
      }
  </style>
</head>

<body>
  <div id="loading" class="loading">
    <div class="loading-container">
      <div class="loading-text">
        <span><img src="/static/logo.png" height="100em" alt="Logo"></span>
        
      </div>
    </div>
    </div>

    <!-- Redesigned Navigation Bar with Font Awesome Icons -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <img src="/static/logo.png" height="40px" alt="Logo">
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
        aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="profileDropdown" role="button" data-toggle="dropdown"
              aria-haspopup="true" aria-expanded="false">
              <i class="fas fa-user-circle"></i> Profile
            </a>
            <div class="dropdown-menu" aria-labelledby="profileDropdown">
              <a class="dropdown-item" href="#" id="changePasswordBtn">
                <i class="fas fa-key"></i> Change Password
              </a>
              <a class="dropdown-item" href="#" onclick="deleteAccount()">
                <i class="fas fa-trash"></i> Delete Account
              </a>
            </div>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="logout()">
              <i class="fas fa-sign-out-alt"></i> Logout
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="card">
      <!-- Recent Files -->
      <div class="card-header">
        <h2 style="color: #ffffff;">Recent Files</h2>
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
      </div>
    
      <div class="card-body text-center">
        <div class="list-group" id="projectList">
          <!-- Project Items-->
          {% for project in projects %}
          <a id="project-{{ project.id }}" href="#" class="list-group-item list-group-item-action d-flex align-items-center">
              <img src="/static/bot.png" alt="Project 2" class="thumbnail">
              {{ project.name }}
              <i class="ml-auto" onclick="showDeleteAlert('{{ project.id }}', '{{ project.name }}')">
                  <lord-icon
                      src="https://cdn.lordicon.com/drxwpfop.json"
                      trigger="hover"
                      colors="primary:#c71f16,secondary:#c71f16"
                      style="width:25px;height:25px"
                  >
                  </lord-icon>
              </i>
          </a>
        {% endfor %}
          <!-- Placeholder when no projects -->
          <div class="placeholder-text" id="placeholderText" style="display: none; text-align: center; padding: 20px; margin: 10px;">
            <i class="fas fa-folder-open fa-3x" style="color: #888;"></i>
            <p style="margin-top: 10px;">No projects available.</p>
          </div>    
        </div>
    
        <!-- Button to start a new project -->
        <button class="btn btn-main mt-3" id="startNewProjectBtn">
          <i class="fas fa-plus-circle mr-2"></i> Start a New Project
        </button>
      </div>
    </div>
        
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script>
        function showDeleteAlert(projectId, projectName) {
        Swal.fire({
            title: 'Delete Project?',
            text: `Are you sure you want to delete ${projectName}?`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.isConfirmed) {
                deleteProject(projectId, projectName);
            }
        });
    }

    function deleteProject(projectId, projectName) {
        fetch(`/delete_project/${projectId}/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({})
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                Swal.fire('Deleted!', `${projectName} has been deleted.`, 'success');
                // Remove the deleted project from the DOM
                const deletedProjectElement = document.getElementById(`project-${projectId}`);
                if (deletedProjectElement) {
                    deletedProjectElement.remove();
                    
                    // If no more projects left, reload the page
                    const remainingProjects = document.querySelectorAll('.list-group-item');
                    if (remainingProjects.length === 0) {
                      noItems();
                    }
                } else {
                    console.error('Error: Project element not found in the DOM.');
                }
            } else {
                Swal.fire('Error', 'Unable to delete the project.', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    // Function to show SweetAlert for logout
    function logout() {
      Swal.fire({
        title: 'Logout',
        text: 'Are you sure you want to logout?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Yes, logout'
      }).then((result) => {
        if (result.isConfirmed) {
              $.ajax({
                type: 'POST',
                url: '/logout/',
                headers: {
                  'X-CSRFToken': $('[name=csrf-token]').attr('content')
                },
                success: function (data) {
                    if (data.success) {
                        Swal.fire(
                          'Logged Out',
                          'You have been successfully logged out.',
                          'success'
                      ).then(() => {
                          setTimeout(() => {
                              window.location.href = '/';
                          }, 0); // You can adjust the timeout value if needed
                      });                    
                    } else {
                        Swal.fire(
                            'Error',
                            'Failed to logout. Please try again.',
                            'error'
                        );
                    }
                },
                error: function () {
                    Swal.fire(
                        'Error',
                        'Failed to logout. Please try again.',
                        'error'
                    );
                }
            });
        }
      });
    }
    
  // Function to show SweetAlert for password change
  function showChangePasswordAlert() {
    Swal.fire({
      title: 'Change Password',
      html:
        '<input type="password" id="oldPassword" class="swal2-input" placeholder="Old Password">' +
        '<input type="password" id="newPassword" class="swal2-input" placeholder="New Password">' +
        '<input type="password" id="confirmPassword" class="swal2-input" placeholder="Confirm Password">',
      showCancelButton: true,
      confirmButtonText: 'Change Password',
      cancelButtonText: 'Cancel',
      showLoaderOnConfirm: true,
      preConfirm: () => {
        const oldPassword = $('#oldPassword').val();
        const newPassword = $('#newPassword').val();
        const confirmPassword = $('#confirmPassword').val();
        // Perform AJAX request to change password
        return $.ajax({
          type: 'POST',
          url: '/change_password/',
          headers: {
            'X-CSRFToken': $('[name=csrf-token]').attr('content')
          },
          data: {
            old_password: oldPassword,
            new_password: newPassword,
            confirm_password: confirmPassword,
          },
        });
      },
      allowOutsideClick: () => !Swal.isLoading(),
    }).then((result) => {
      if (result.isConfirmed && result.value.success) {
        Swal.fire('Password Changed!', 'Your password has been successfully changed.', 'success')
          .then(() => {
            setTimeout(() => {
                window.location.href = '/';
            }, 0); // You can adjust the timeout value if needed
        });
      } else if (result.isConfirmed) {
        Swal.fire('Error', 'Failed to change password. Please try again.', 'error');
      }
    });
  }

  // Attach click event to the "Change Password" button
  $('#changePasswordBtn').on('click', function () {
    showChangePasswordAlert();
  });

  function deleteAccount() {
    Swal.fire({
      title: 'Delete Account?',
      text: 'Are you sure you want to delete your account? This action cannot be undone.',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#d33',
      cancelButtonColor: '#3085d6',
      confirmButtonText: 'Yes, delete it!'
    }).then((result) => {
      if (result.isConfirmed) {
        $.ajax({
          type: 'POST',
          url: '/delete_account/',
          headers: {
            'X-CSRFToken': $('[name=csrf-token]').attr('content')
          },
          success: function (data) {
            if (data.success) {
              Swal.fire(
                'Account Deleted!',
                'Your account has been successfully deleted.',
                'success'
              ).then(() => {
                setTimeout(() => {
                  window.location.href = '/';
                }, 0);
              });
            } else {
              Swal.fire(
                'Error',
                'Failed to delete account. Please try again.',
                'error'
              );
            }
          },
          error: function () {
            Swal.fire(
              'Error',
              'Failed to delete account. Please try again.',
              'error'
            );
          }
        });
      }
    });
  }

// Function to show SweetAlert prompt for a new project name
function showNewProjectPrompt() {
  Swal.fire({
    title: 'Enter project name:',
    input: 'text',
    inputAttributes: {
      autocapitalize: 'off',
      style: 'text-align: center; width: 80%; margin: 0 auto;', // Centered and wide
    },
    showCancelButton: true,
    confirmButtonText: 'Create Project',
    showLoaderOnConfirm: true,
    preConfirm: (projectName) => {
      if (!projectName) {
        Swal.showValidationMessage('Please enter a project name');
        return false;
      }

      // Send the project name to Django using AJAX
      return $.ajax({
        url: '/create_project/',  // Update with your Django endpoint
        method: 'POST',
        headers: {
          'X-CSRFToken': $('[name=csrf-token]').attr('content')
        },
        data: {
          'project_name': projectName,
          // Add any additional data you want to send to the backend
        },
        error: function (xhr, status, error) {
          Swal.showValidationMessage(`Request failed: ${error}`);
        }
      });
    },
    allowOutsideClick: () => !Swal.isLoading()
  }).then((result) => {
    if (result.value) {
      // Reload the page or update the project list as needed
      location.reload();  // Reload the page for simplicity
    }
  });
}

// Event listener for the "Start a New Project" button
$('#startNewProjectBtn').click(function () {
  showNewProjectPrompt();
});


  </script>
  <script>
      const loader = document.getElementById('loading');      
      setTimeout(function() {
          loader.style.display = "none";
      }, 2000);
  </script>
</body>

</html>


<script>
  // Check if there are no project items and display the placeholder text
  window.onload =  noItems();

  function noItems() {
    var projectList = document.getElementById('projectList');
    var placeholderText = document.getElementById('placeholderText');

    if (projectList.children.length === 1) {
      placeholderText.style.display = 'block';
    } else {
      placeholderText.style.display = 'none';
    }
  }
</script>